# tfinclude

tfinclude is an include tf file generator for Terraform/Terragrunt.

## Usage

```bash
Usage:
    tfinclude -s SOURCE_DIR [-r SOURCE_REGEX] [-o OUTPUT_FILE]

    Options:
        -s Source directory, ex: include/
        -r Regular expression(regex type: egrep) for file path, default: ".*\.(tf|hcl)$")
        -o Output file, default: generated_include.tf

    Examples:
        Generate generated_include.tf file from include/*.tf|.hcl files
            tfinclude -s include/
        Generate path/to/include.tf file from include/*.hcl files
            tfinclude -s include/ -r ".*\.hcl$" -o path/to/include.tf
```

## Using tfinclude with Terraform

This is an example of the simplest way to run `tfincldue` manually.

Before generation:

```bash
$ tree
.
├── include
│   ├── example1.tf
│   └── example2.tf
└── main.tf
```

`include/example1.tf` resource:

```
locals {
  foo = "value1"
}

```

`include/example2.tf` resource:

```
locals {
  bar = "value2"
}

```

Run `tfinclude` manually:

```
$ tfinclude -s include/

$ tree
.
├── generated_include.tf
├── include
│   ├── example1.tf
│   └── example2.tf
└── main.tf
```

Generated `generated_include.tf` resource:

```
# Generated by tfinclude.
# SOURCE_DIR: include/
# SOURCE_REGEX: .*\.(tf|hcl)$

locals {
  foo = "value1"
}

locals {
  bar = "value2"
}

```

It is recommended to add `generated*.tf` or `generated_include.tf` to `.gitignore`.

## Using tfinclude with Terragrunt

This is an example of using Terragrunt to automatically run `tfinclude` only under the `sub1` directory.

Before generation:

```bash
$ tree
.
├── main.tf
├── provider.hcl
├── sub1
│   ├── sub1.tf
│   └── terragrunt.hcl
├── sub2
│   ├── sub2.tf
│   └── terragrunt.hcl
├── terragrunt.hcl
└── vars
    └── sub1
        ├── example1.tf
        └── example2.hcl
```

`terragrunt.hcl` resource:

`${file("...")}` function provides another include feature, but does not allow wildcards in the file path.

```
generate "generated" {
  path      = "generated.tf"
  if_exists = "overwrite_terragrunt"

  contents = <<CONTENTS
${file("provider.hcl")}
CONTENTS
}
```

`vars/sub1/example1.tf` resource:

```
locals {
  foo = "value1"
}

```

`vars/sub1/example2.hcl` resource:

```
locals {
  bar = "value2"
}

```

`sub1/terragrunt.hcl` resource:

`run_cmd` is a terragrunt build-in function that runs a shell command and returns the stdout as the result of the interpolation.

```
include "root" {
  path = find_in_parent_folders()
}

locals {
  sub1_tfinclude = run_cmd("tfinclude", "-s", "../vars/sub1/")
}
```

`sub2/terragrunt.hcl` resource:

In this example, `tfinclude` is not used under the sub2 directory.

```
include "root" {
  path = find_in_parent_folders()
}
```

Run terragrunt validate or other sub commands:

```bash
$ terragrunt run-all validate
INFO[0000] The stack at /path/to will be processed in the following order for command validate:
Group 1
- Module /path/to
- Module /path/to/sub1
- Module /path/to/sub2

Success! The configuration is valid.

Success! The configuration is valid.

Success! The configuration is valid.

$ tree
.
├── generated.tf
├── main.tf
├── provider.hcl
├── sub1
│   ├── generated_include.tf
│   ├── generated.tf
│   ├── sub1.tf
│   └── terragrunt.hcl
├── sub2
│   ├── generated.tf
│   ├── sub2.tf
│   └── terragrunt.hcl
├── terragrunt.hcl
└── vars
    └── sub1
        ├── example1.tf
        └── example2.hcl
```

Generated `sub1/generated_include.tf` resource:

```
# Generated by tfinclude.
# SOURCE_DIR: ../vars/sub1/
# SOURCE_REGEX: .*\.(tf|hcl)$

locals {
  foo = "value1"
}

locals {
  bar = "value2"
}

```

## License

MIT
